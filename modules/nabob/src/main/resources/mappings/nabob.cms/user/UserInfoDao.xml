<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nabobsite.modules.nabob.cms.user.dao.UserInfoDao">

	<!-- 查询数据
	<select id="findList" resultType="UserInfo">
		SELECT ${sqlMap.column.toSql()}
		FROM ${sqlMap.table.toSql()}
		<where>
			${sqlMap.where.toSql()}
		</where>
		ORDER BY ${sqlMap.order.toSql()}
	</select> -->

	<!--获取达到等级的直推团队人数-->
	<update id="getOkLevelTeamNum1" parameterType="com.nabobsite.modules.nabob.cms.user.entity.UserInfo">
		SELECT
		    IFNULL(count(id),0)
		FROM
			t1_user_info
		where
			parent_user_id = #{id} and  level &lt;= (select IFNULL(level-1,0) from t1_user_info where id = #{id} and lock =2 and level>1)
	</update>

	<!--增加一级团队-->
	<update id="updateTeam1" parameterType="com.nabobsite.modules.nabob.cms.user.entity.UserInfo">
		update
			t1_user_info
		<set>
			<if test="teamNum != null ">
				team_num = team_num + #{teamNum},
				team_num_1 = team_num_1 + #{teamNum},
			</if>
			updated = sysdate()
		</set>
		<where>
			id = #{id} and  (team_num + #{teamNum}) >= 0 and  (team_num_1 + #{teamNum}) >= 0
		</where>
	</update>

	<!--增加二级团队-->
	<update id="updateTeam2" parameterType="com.nabobsite.modules.nabob.cms.user.entity.UserInfo">
		update
		t1_user_info
		<set>
			<if test="teamNum != null ">
				team_num = team_num + #{teamNum},
				team_num_2 = team_num_2 + #{teamNum},
			</if>
			updated = sysdate()
		</set>
		<where>
			id = #{id} and  (team_num + #{teamNum}) >= 0 and  (team_num_2 + #{teamNum}) >= 0
		</where>
	</update>

	<!--增加三级团队-->
	<update id="updateTeam3" parameterType="com.nabobsite.modules.nabob.cms.user.entity.UserInfo">
		update
		t1_user_info
		<set>
			<if test="teamNum != null ">
				team_num = team_num + #{teamNum},
				team_num_3 = team_num_3 + #{teamNum},
			</if>
			updated = sysdate()
		</set>
		<where>
			id = #{id} and  (team_num + #{teamNum}) >= 0 and  (team_num_3 + #{teamNum}) >= 0
		</where>
	</update>
</mapper>
