<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nabobsite.modules.nabob.cms.user.dao.UserAccountDao">
	
	<!-- 查询数据
	<select id="findList" resultType="UserAccount">
		SELECT ${sqlMap.column.toSql()}
		FROM ${sqlMap.table.toSql()}
		<where>
			${sqlMap.where.toSql()}
		</where>
		ORDER BY ${sqlMap.order.toSql()}
	</select> -->

	<!--增加-->
	<update id="updateAccountClaimable" parameterType="com.nabobsite.modules.nabob.cms.user.entity.UserAccount">
		update
		    t1_user_account
		<set>
			claimable_money = 0,
			available_money = available_money + claimable_money,
			total_money = total_money + claimable_money,
			updated = sysdate()
		</set>
		<where>
			user_id = #{userId}
		</where>
	</update>

	<!--增加-->
	<update id="updateAccountMoney" parameterType="com.nabobsite.modules.nabob.cms.user.entity.UserAccount">
		update
		t1_user_account
		<set>
			<if test="totalMoney != null and totalMoney !=0">
				total_money = total_money + #{totalMoney},
			</if>
			<if test="rechargeMoney != null and rechargeMoney !=0">
				recharge_money = recharge_money + #{rechargeMoney},
			</if>
			<if test="availableMoney != null and availableMoney !=0">
				available_money = available_money + #{availableMoney},
			</if>
			<if test="commissionMoney != null and commissionMoney !=0">
				commission_money = commission_money + #{commissionMoney},
			</if>
			<if test="incrementMoney != null and incrementMoney !=0">
				increment_money = increment_money + #{incrementMoney},
			</if>
			<if test="claimableMoney != null and claimableMoney !=0">
				claimable_money = claimable_money + #{claimableMoney},
			</if>
			<if test="remarks != null and remarks !='' ">
				remarks = #{remarks},
			</if>
			updated = sysdate()
		</set>
		<where>
			<if test="totalMoney != null and totalMoney !=0">
				(total_money + #{totalMoney}) >= 0 and
			</if>
			<if test="availableMoney != null and availableMoney !=0">
				(available_money + #{availableMoney}) >= 0 and
			</if>
			<if test="commissionMoney != null and commissionMoney !=0">
				(commission_money + #{commissionMoney}) >= 0 and
			</if>
			<if test="incrementMoney != null and incrementMoney !=0">
				(increment_money + #{incrementMoney}) >= 0 and
			</if>
			<if test="claimableMoney != null and claimableMoney !=0">
				(claimable_money + #{claimableMoney}) >= 0 and
			</if>
			user_id = #{userId}
		</where>
	</update>
</mapper>